---
/* ============================= */
/* SOCIAL COMMAND DATA           */
/* ============================= */

const profiles = [
   { network: "LinkedIn", url: "http://www.linkedin.com/in/santiagogoncalvez" },
   { network: "GitHub", url: "https://github.com/santiagogoncalvez" },
];

const SOCIAL_ICONS: Record<string, string> = {
   GitHub: `
<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
  <path d="M12 .297c-6.63 0-12 5.373-12 12 
  0 5.303 3.438 9.8 8.205 11.385
  .6.113.82-.258.82-.577
  0-.285-.01-1.04-.015-2.04
  -3.338.724-4.042-1.61-4.042-1.61
  C4.422 18.07 3.633 17.7 3.633 17.7
  c-1.087-.744.084-.729.084-.729
  1.205.084 1.838 1.236 1.838 1.236
  1.07 1.835 2.809 1.305 3.495.998
  .108-.776.417-1.305.76-1.605
  -2.665-.3-5.466-1.332-5.466-5.93
  0-1.31.465-2.38 1.235-3.22
  -.135-.303-.54-1.523.105-3.176
  0 0 1.005-.322 3.3 1.23
  .96-.267 1.98-.399 3-.405
  1.02.006 2.04.138 3 .405
  2.28-1.552 3.285-1.23 3.285-1.23
  .645 1.653.24 2.873.12 3.176
  .765.84 1.23 1.91 1.23 3.22
  0 4.61-2.805 5.625-5.475 5.92
  .42.36.81 1.096.81 2.22
  0 1.606-.015 2.896-.015 3.286
  0 .315.21.69.825.57
  C20.565 22.092 24 17.592 24 12.297
  c0-6.627-5.373-12-12-12z"/>
</svg>`,

   LinkedIn: `
<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
  <path d="M20.447 20.452h-3.554v-5.569
  c0-1.328-.027-3.037-1.852-3.037
  -1.853 0-2.136 1.445-2.136 2.939
  v5.667H9.351V9h3.414v1.561h.046
  c.477-.9 1.637-1.85 3.37-1.85
  3.601 0 4.267 2.37 4.267 5.455
  v6.286zM5.337 7.433
  c-1.144 0-2.063-.926-2.063-2.065
  0-1.138.92-2.063 2.063-2.063
  1.14 0 2.064.925 2.064 2.063
  0 1.139-.925 2.065-2.064 2.065z
  M7.119 20.452H3.555V9h3.564v11.452z
  M22.225 0H1.771
  C.792 0 0 .774 0 1.729v20.542
  C0 23.227.792 24 1.771 24h20.451
  C23.2 24 24 23.227 24 22.271V1.729
  C24 .774 23.2 0 22.222 0h.003z"/>
</svg>`,
};

const profilesInfo = profiles.map(({ network, url }) => ({
   id: network,
   section: "Social",
   title: `Visitar ${network}`,
   url,
   icon: SOCIAL_ICONS[network],
   hotkey: `ctrl+${network[0].toUpperCase()}`,
}));
---

<!-- ============================= --><!-- COMMAND TRIGGER UI            --><!-- ============================= -->
<div id="command-container" class="no-print">
   <!-- Desktop label -->
   <div
      id="command-label"
      class="command command-label bg-title dark:bg-bg-surface text-bg-surface dark:text-title"
   >
      Comandos <kbd class="bg-title-secondary dark:bg-border-strong">Ctrl</kbd> +
      <kbd class="bg-title-secondary dark:bg-border-strong">K</kbd>
   </div>

   <!-- Mobile button -->
   <button
      id="command-button"
      class="command command-button bg-title dark:bg-bg-elevated text-bg-elevated dark:text-title border border-text dark:border-text-muted"
      aria-label="Abrir comandos"
   >
      <svg
         xmlns="http://www.w3.org/2000/svg"
         width="24"
         height="24"
         stroke="currentColor"
         fill="none"
      >
         <path
            d="M7 9a2 2 0 1 1 2 -2v10a2 2 0 1 1 -2 -2h10a2 2 0 1 1 -2 2v-10a2 2 0 1 1 2 2h-10"
         ></path>
      </svg>
   </button>
</div>

<!-- ============================= -->
<!-- HOTKEYPAD ROOT                -->
<!-- ============================= -->

<div
   id="hotkeypad"
   data-placeholder="Buscar comando"
   data-info={JSON.stringify(profilesInfo)}
>
</div>

<script>
   import HotKeyPad from "hotkeypad";
   import "hotkeypad/index.css";

   document.addEventListener("astro:page-load", () => {
      /* ============================= */
      /* HOTKEYPAD INIT                */
      /* ============================= */

      const hotkeypad = new HotKeyPad();

      const updateTheme = () => {
         const isDark = document.documentElement.classList.contains("dark");
         hotkeypad.instance.classList.toggle("dark", isDark);
         hotkeypad.instance.classList.toggle("light", !isDark);
         hotkeypad.instance.setAttribute(
            "data-theme",
            isDark ? "dark" : "light"
         );
      };

      new MutationObserver(updateTheme).observe(document.documentElement, {
         attributes: true,
         attributeFilter: ["class"],
      });

      updateTheme();

      const info = JSON.parse(
         hotkeypad.instance.getAttribute("data-info") ?? "[]"
      );

      const socialCommands = info.map((item) => ({
         ...item,
         handler: () => window.open(item.url, "_blank"),
      }));

      hotkeypad.setCommands([
         {
            id: "download-cv",
            title: "Descargar CV",
            section: "Acciones",
            hotkey: "ctrl+D",
            icon: `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>`,
            handler: () => {
               const a = document.createElement("a");
               a.href = "/Santiago-Goncalvez-Curriculum-Vitae.pdf";
               a.download = "Santiago-Goncalvez-CV.pdf";
               a.click();
            },
         },
         {
            id: "open-email",
            title: "Enviar correo",
            section: "Acciones",
            hotkey: "ctrl+E",
            icon: `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M4 4h16v16H4z"/><polyline points="22,6 12,13 2,6"/></svg>`,
            handler: () => {
               window.location.href = "mailto:santiago.goncalvez.l@gmail.com";
            },
         },
         ...socialCommands,
      ]);

      const commandButton = document.getElementById("command-button");

      commandButton?.addEventListener("click", () => {
         hotkeypad.open();
         // commandButton.classList.add("hidden");
      });

      /* ============================= */
      /* SCROLL VISIBILITY LOGIC       */
      /* ============================= */

      const label = document.getElementById("command-label");
      const button = document.getElementById("command-button");

      let lastScroll = window.scrollY;

      const updateVisibility = () => {
         const y = window.scrollY;

         if (y < 24) {
            label?.classList.remove("is-visible");
            button?.classList.remove("is-visible");
         } else if (y > lastScroll) {
            label?.classList.add("is-visible");
            button?.classList.add("is-visible");
         }

         lastScroll = y;
      };

      window.addEventListener("scroll", updateVisibility, { passive: true });
      updateVisibility();

      
   });
</script>

<style>
   /* ============================= */
   /* COMMAND UI                    */
   /* ============================= */

   #command-container {
      position: fixed;
      right: 1rem;
      bottom: 1rem;
      pointer-events: none;
   }

   .command {
      pointer-events: auto;
      opacity: 0;
      transform: translateY(12px);
      transition:
         opacity 0.25s ease,
         transform 0.25s ease;
   }

   .command.is-visible {
      opacity: 1;
      transform: translateY(0);
   }

   .command-label {
      display: none;
      padding: 8px 12px;
      border-radius: 10px;
      font-size: 0.85rem;
   }

   .command-button {
      display: none;
      width: 56px;
      height: 56px;
      border-radius: 14px;
      cursor: pointer;
      z-index: 0;
   }

   .command-button.hidden {
      display: none;
   }

   /* .dark .command-button {
      border: 1px solid var(--color-border-subtle);
      background: var(--color-bg-elevated);
      color: var(--color-title);
   } */

   @media (min-width: 768px) {
      .command-label {
         display: inline-flex;
         gap: 6px;
         align-items: center;
      }
   }

   @media (max-width: 767px) {
      .command-button {
         display: flex;
         align-items: center;
         justify-content: center;
      }
   }

   kbd {
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 10px;
   }

   /* ============================= */
   /* HOTKEYPAD DARK THEME          */
   /* ============================= */

   #hotkeypad.dark {
      --hotkeypad-bg-backdrop: var(--color-bg-deep);
      --hotkeypad-bg-container: var(--color-bg-elevated);
      --hotkeypad-bg-item-hover: var(--color-border-strong);
      --hotkeypad-border-container: var(--color-border-subtle);
      --hotkeypad-fg: var(--color-title);
      --hotkeypad-fg-muted: var(--color-text);
      --hotkeypad-bg-kbd: var(--color-bg-elevated);
      --hotkeypad-fg-kbd: var(--color-text);
   }
</style>
